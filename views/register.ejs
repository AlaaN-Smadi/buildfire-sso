<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      function afterRegister(username, access_token) {
        const result = {
          status: "success",
          user: { username: username, access_token: access_token },
        };
        window.parent.postMessage(JSON.stringify(result), "*");
      }

      function createUser() {
        const email = document.querySelector('input[name="email"]').value;
        const username = document.querySelector('input[name="username"]').value;
        const password = document.querySelector('input[name="password"]').value;
        
        fetch('/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            email: email,
            username: username,
            password: password
          })
        }).then((res) => {
          if (!res.ok) {
            return res.json().then((data) => {
              throw new Error(data.message || 'Registration failed');
            });
          }
          return res.json();
        }).then((data) => {
          afterRegister(email, data.access_token);
        }).catch((error) => {
          console.error('Error:', error);
          alert('Registration failed: ' + error.message);
        })
      }
    </script>
  </head>
  <body>
    <div>
      <label>username</label>
      <input type="text" name="username" />
    </div>
    <div>
      <label>Email</label>
      <input type="text" name="email" />
    </div>
    <div>
      <label>Password</label>
      <input type="password" name="password" />
    </div>
    <div>
      <button onclick="createUser();">Register</button>
    </div>
  </body>
</html>